<!DOCTYPE html>
<html lang="en">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Worm-Blog</title>
	<style>
	body{
		padding: 1rem;
		margin: 0 auto;
		max-width: 640px;
		background: teal;
		}
	a {
		color: red;
		}
		p span{
		text-align: center;
		color: rgb(28, 162, 37);
		font-family: "Courier New", Times, serif;
		}
        p {
		font-family: "Courier New", Times, serif;
        }
		.round3 {
        border: 3px solid #95acca;
        border-radius: 12px;
        padding: 5px;
        background: #e0e3ec;}
	th {
		background-color: rgb(147, 121, 121);
		color: #fff;
	}
		
    td {
        border-top: 1px solid #fff;
		background-color: rgb(147, 121, 121);
    }
    th {
        padding-top: 6px;
        border: 1px solid #fff;

    }
    td:nth-child(2) { 
        color: aqua;
     }
    td:nth-child(1) { 
        padding: 5px;
     }
	</style>
</head>
  <body><h1><img src="Art/Home/comp worm.gif" style="width:100%" /></h1>
<p><a href="index.html">Return Home</a></p>

<div class="round3" style="text-align: center;">
<p><strong>c u r l y</strong></p>
<p><strong><small>Submiting forms with curl POST command</small></strong></p>
</div>
<p style="text-align: center;"><small>November 14, 2025</small></p>

<div style="display:flex; justify-content: center;">
		<img src="Art/cl/budwiser.gif" style="width: 40%; border: 3px solid black;">
</div>
<br>
<div class="round3">
	<p>Potential Use Case: signing in/accepting "terms of service" on public wifi networks without using a browser. </p>
</div>
<div class="round3">
	<p>I kind of fell down this rabbit hole after a mutual of mine in a discord server I'm in was saying they have been playing around on an ancient laptop with windows xp on it. And he'd like to connect to the wifi at his university. But unfortunetly the browser he has is so old that it doesnt redirect him to the networks login page. So I thought I'd give it a try with curl</p>
</div>
<br>
<div class="round3">
	<p><strong>Test 1 :</strong><br><br>
	find the elements on the webpage you need to interact with. Either with curl "https://example.com" and looking through the html directly<br><br>
OR - (easier)<br>
open webpage in a browser and right click on element (text box, etc. ) -> "inspect"<br>
<br>What we are looking for is the "name" of these input fields. (see image below)
<img src="Art/cl/inspectElement.png" style="width: 100%;">
<br>We will use this name and pair it with what we want to input in that field, into our JSON. Which follows the format <br>
{"key1": "value1", "key2": "value2"}
</p>
</div>
<div class="round3">
	<p>Now we can start building our curl command. The basic parts we will use are: </p>
	<table>
		<th>argument</th><th>description</th>
		<tr>
			<td>-X POST</td>
			<td>tells curl we will be sending data</td>
		</tr>
		<tr>
			<td>-H "Content-Type: application/json"</td>
			<td>tells curl the data type</td>
		</tr>
		<tr>
			<td>-d 'ur data go here'</td>
			<td>the data in question</td>
		</tr>
	</table>
	<br>
	<p>curl -X POST <span>www.website.com</span> -H "Content-Type: application/json" -d '{<span>your json data goes here</span>}'</p>
</div>
<div class="round3">
	<p>
		<a href="https://httpbin.org/post">https://httpbin.org/post</a><br><br>This is a useful example website to make sure your sending the correct data. It simply echos back a JSON response to what you send it. <br>
		<br>
		testing out our command:<br><br>
		curl -X POST https://httpbin.org/post -H "Content-Type: application/json" -d '{"login": "Organism", "password": "CryptOrchid", "accept_terms": true}'<br>
		<br><br><img src="Art/cl/curlPost.png" style="width: 100%;"><br>
	as you can see within the "json" { } brackets, the testing website echos it back correctly.</p>
</div>
<div class="round3">
	<p>
		<strong>Test 2:</strong> <br>
		<p>You may get a server response of "csrf-Token missing". To get past this you will need to get the token from the curl response previously and then send it with your data. OR the token may be included in a cookie, you can save to a text file to extract it<br>
		<br>
	<p>I am testing on the Fedora linux account login website, and here the token is inside a hidden input field.</p>
	<p>First I create a variable called TOKEN, curl the website and then pipe it into a grep command which searches for the hidden input field of the token. I then use the cut command and a few reverses to trim off the leading and trailing quotes so only the token itself goes into my variable "TOKEN"</p>
	<p><span>TOKEN=$(curl https://accounts.fedoraproject.org/ | grep -oP 'name="login-csrf_token" type="hidden" value="\K.*' | rev| cut -c 3- | rev)</span></p>
	<p>next step is to send the data with the token</p>
	<p><span>
		curl --data "login-username=my_username&login-password=my_password&login-csrf_token=$TOKEN" "https://accounts.fedoraproject.org/"
	</span><br>
-------------------------------------------------------</p>
	<br>
	<p>we're getting closer</p>
	<img src="Art/cl/csrfError.png" style="width: 100%;">
	<p style="color: red;">the token is getting recieved...but its not the right one. I believe the reason being is that we are using 2 seperate, distinct curl commands. So when we try to post the data/token it's generating a new one as well.</p>
</div>
<br>
<div class="round3">
	<p>
		<strong>Test 3:</strong><br>
		<p>Lets ensure we are using the name session by first saving a cookie with -c to a text file we will call "cookies.txt". And then in our second curl we send that cookie with -b.<br>I also had to include an '-H "referer: "' argument as the server gave an error that there wasn't one.</p>
		<p><span>TOKEN=$(curl -c cookies.txt https://accounts.fedoraproject.org/ | grep -oP 'name="login-csrf_token" type="hidden" value="\K.*' | rev| cut -c 3- | rev)</span></p>
		<p><span>curl -H "Referer: https://accounts.fedoraproject.org/" -b cookies.txt --data "login-username=my_username&login-password=my_password&login-csrf_token=$TOKEN" "https://accounts.fedoraproject.org/"</span></p>
		<p>This seems to work, however the html that is returned is the same as the login page, however going through it it does appear our inputs have been filled out. We just need to figure out how to script the "submit" button being pressed</p>
	</p>
</div>
<br>
<div class="round3">
	<p><strong>Test 4:</strong><br></p>
	<p>I found a very useful plug-in for firefox called "live Https headers" that prints off all the requests made when you interact with a webpage. I then was able to see that when I press the "log in" button, it was changing the value of the button to 1. So all I had to do was add this in to my second command when I post the username/password/token.<br><br>
	And finally it is also required to add a "-L" to tell curl to accept redirects. As by default curl will not. </p>
	<br>
	<p><strong>Conclusion:</strong></p>
	<br>
	<p>My final commands are :</p>
	<p> 1 : <span>TOKEN=$(curl -c cookies.txt https://accounts.fedoraproject.org/ | grep -oP 'name="login-csrf_token" type="hidden" value="\K.*' | rev| cut -c 3- | rev)</span></p>
	<p> 2 : <span>curl -H "Referer: https://accounts.fedoraproject.org/" -b cookies.txt --data "login-username=my_email&login-password=my_password&login-csrf_token=$TOKEN&login-otp=&login-submit=1" "https://accounts.fedoraproject.org/" -L</span></p>
<p>------------------------------</p>
<p>command 1 :<br> 1.1 curls webpage<br>1.2 saves cookie<br>1.3 stores csrf_token into variable</p>
<p>command 2 :<br>2.1 curls webpage sending cookie and referal address<br>2.2 submits username/password/csrf_token/button_input<br>2.3 allows redirection with -L</p>
</div>
<p><a href="index.html">Return Home</a></p>
 
 </body>
</html>